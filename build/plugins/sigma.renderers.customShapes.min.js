(function(){"use strict";var a=[],b=function(b,c,d){a.push({name:b,drawShape:c,drawBorder:d})},c=function(){return a},d=function(a){return function(b,c,d,e,f,g){g.fillStyle=f,g.beginPath(),a(b,c,d,e,g),g.closePath(),g.fill()}},e=function(a){return function(b,c,d,e,f,g){g.strokeStyle=f,g.lineWidth=e/5,g.beginPath(),a(b,c,d,e,g),g.closePath(),g.stroke()}},f=function(a,b,c,d,e){var f=45*Math.PI/180;e.moveTo(b+d*Math.sin(f),c-d*Math.cos(f));for(var g=1;4>g;g++)e.lineTo(b+Math.sin(f+2*Math.PI*g/4)*d,c-Math.cos(f+2*Math.PI*g/4)*d)};b("square",d(f),e(f));var g=function(a,b,c,d,e){e.arc(b,c,d,0,2*Math.PI,!0)};b("circle",d(g),e(g));var h=function(a,b,c,d,e){e.moveTo(b-d,c),e.lineTo(b,c-d),e.lineTo(b+d,c),e.lineTo(b,c+d)};b("diamond",d(h),e(h));var i=function(a,b,c,d,e){var f=a.cross&&a.cross.lineWeight||5;e.moveTo(b-d,c-f),e.lineTo(b-d,c+f),e.lineTo(b-f,c+f),e.lineTo(b-f,c+d),e.lineTo(b+f,c+d),e.lineTo(b+f,c+f),e.lineTo(b+d,c+f),e.lineTo(b+d,c-f),e.lineTo(b+f,c-f),e.lineTo(b+f,c-d),e.lineTo(b-f,c-d),e.lineTo(b-f,c-f)};b("cross",d(i),e(i));var j=function(a,b,c,d,e){var f=a.equilateral&&a.equilateral.numPoints||5,g=(a.equilateral&&a.equilateral.rotate||0)*Math.PI/180,h=d;e.moveTo(b+h*Math.sin(g),c-h*Math.cos(g));for(var i=1;f>i;i++)e.lineTo(b+Math.sin(g+2*Math.PI*i/f)*h,c-Math.cos(g+2*Math.PI*i/f)*h)};b("equilateral",d(j),e(j));var k=function(a,b,c,d,e){var f=a.star&&a.star.numPoints||5,g=a.star&&a.star.innerRatio||.5,h=d,i=d*g,j=Math.PI/f;e.moveTo(b,c-d);for(var k=0;f>k;k++)e.lineTo(b+Math.sin(j+2*Math.PI*k/f)*i,c-Math.cos(j+2*Math.PI*k/f)*i),e.lineTo(b+Math.sin(2*Math.PI*(k+1)/f)*h,c-Math.cos(2*Math.PI*(k+1)/f)*h)};b("star",d(k),e(k));var l=function(a,b,c,d,e,f){f.fillStyle="yellow",f.beginPath(),f.arc(b,c,d,1.25*Math.PI,0,!1),f.arc(b,c,d,0,.75*Math.PI,!1),f.lineTo(b,c),f.closePath(),f.fill(),f.fillStyle="white",f.strokeStyle="black",f.beginPath(),f.arc(b+d/3,c-d/3,d/4,0,2*Math.PI,!1),f.closePath(),f.fill(),f.stroke(),f.fillStyle="black",f.beginPath(),f.arc(b+4*d/9,c-d/3,d/8,0,2*Math.PI,!1),f.closePath(),f.fill()};b("pacman",l,null),this.ShapeLibrary={enumerate:c,version:"0.1"}}).call(this),function(a){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";if("undefined"==typeof ShapeLibrary)throw"ShapeLibrary is not declared";sigma.utils.pkg("sigma.canvas.nodes"),sigma.utils.pkg("sigma.svg.nodes");var b=a,c={},d=function(a){b=a},e=function(a,d,e,f,g){if(b&&a.image&&a.image.url){var h=a.image.url,i=a.image.h||1,j=a.image.w||1,k=a.image.scale||1,l=a.image.clip||1,m=c[h];m||(m=document.createElement("IMG"),m.src=h,m.onload=function(){console.log("redraw on image load"),b.refresh()},c[h]=m);var n=i>j?j/i:1,o=j>i?i/j:1,p=f*k;g.save(),g.beginPath(),g.arc(d,e,f*l,0,2*Math.PI,!0),g.closePath(),g.clip(),g.drawImage(m,d+Math.sin(-0.7855)*p*n,e-Math.cos(-0.7855)*p*o,p*n*2*Math.sin(-0.7855)*-1,p*o*2*Math.cos(-0.7855)),g.restore()}},f=function(a,b,c){var d=c("classPrefix");if(a.image&&a.image.url&&1===b.childNodes.length){{var e=a.cssClass?" "+a.cssClass:"",f=document.createElementNS(c("xmlns"),"circle"),g=document.createElementNS(c("xmlns"),"clipPath"),h=c("clipPathPrefix")+"-clip-path-"+a.id,i=document.createElementNS(c("xmlns"),"defs"),j=document.createElementNS(c("xmlns"),"image");a.image.url}g.setAttributeNS(null,"id",h),g.appendChild(f),i.appendChild(g);var k=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;k=k.split("#")[0],j.setAttributeNS(null,"class",d+"-node-image"+e),j.setAttributeNS(null,"clip-path","url("+k+"#"+h+")"),j.setAttributeNS(null,"pointer-events","none"),j.setAttributeNS("http://www.w3.org/1999/xlink","href",a.image.url),b.appendChild(i),b.appendChild(j)}else if(!a.image||!a.image.url)for(var l,m=b.childNodes,n=0;n<m.length;)l=m[n].getAttribute("class"),!l||l.indexOf(d+"-node-")>-1||l.indexOf(d+"-node")<0?b.removeChild(m[n]):n++},g=function(a,b,c){sigma.canvas.nodes[a]=function(a,d,f){var g=(arguments,f("prefix")||""),h=a[g+"size"],i=a.color||f("defaultNodeColor"),j=a.borderColor||i,k=a[g+"x"],l=a[g+"y"];d.save(),b&&b(a,k,l,h,i,d),c&&c(a,k,l,h,j,d),e(a,k,l,h,d),d.restore()},sigma.svg.nodes[a]={create:function(a,b){var c=document.createElementNS(b("xmlns"),"g"),d=document.createElementNS(b("xmlns"),"circle");return c.setAttributeNS(null,"class",b("classPrefix")+"-node-group"),c.setAttributeNS(null,"data-node-id",a.id),d.setAttributeNS(null,"data-node-id",a.id),d.setAttributeNS(null,"class",b("classPrefix")+"-node"),d.setAttributeNS(null,"fill",a.color||b("defaultNodeColor")),c.appendChild(d),c},update:function(a,b,c){f(a,b,c);for(var d=a.cssClass?" "+a.cssClass:"",e=c("classPrefix"),g=a.image.clip||1,h=a.image.h||1,i=a.image.w||1,j=c("prefix")||"",k=a.image.scale||1,l=a[j+"size"],m=a[j+"x"],n=a[j+"y"],o=k*l,p=h>i?i/h:1,q=i>h?h/i:1,r=0,s=b.childNodes;r<s.length;r++){var t=s[r].getAttribute("class");if(t)t.indexOf(e+"-node-")>-1?(s[r].setAttributeNS(null,"x",m+Math.sin(-0.7855)*o*p),s[r].setAttributeNS(null,"y",n-Math.cos(-0.7855)*o*q),s[r].setAttributeNS(null,"width",o*p*2*Math.sin(-0.7855)*-1),s[r].setAttributeNS(null,"height",o*q*2*Math.cos(-0.7855)),s[r].setAttributeNS(null,"class",e+"-node-image"+d),s[r].setAttributeNS("http://www.w3.org/1999/xlink","href",a.image.url)):t.indexOf(e+"-node")>-1&&(s[r].setAttributeNS(null,"cx",m),s[r].setAttributeNS(null,"cy",n),s[r].setAttributeNS(null,"r",l),s[r].setAttributeNS(null,"class",e+"-node"+d),c("freeStyle")||s[r].setAttributeNS(null,"fill",a.color||c("defaultNodeColor")));else{var u=s[r].firstChild;if(null!=u){var v=c("clipPathPrefix")+"-clip-path-"+a.id;u.getAttribute("id")===v&&(u.firstChild.setAttributeNS(null,"cx",m),u.firstChild.setAttributeNS(null,"cy",n),u.firstChild.setAttributeNS(null,"r",g*l))}}}b.style.display=""}}};ShapeLibrary.enumerate().forEach(function(a){g(a.name,a.drawShape,a.drawBorder)}),this.CustomShapes={init:d,version:"0.1"}}.call(this);